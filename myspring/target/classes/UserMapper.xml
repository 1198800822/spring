<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.sundd.myspring.mapper.UserMapper">
<!-- 
	<cache type="org.mybatis.caches.ehcache.EhcacheCache" />
 -->
 
 	<!-- mybatis自带缓存> 	-->
 	<cache></cache>	
	
	<sql id="cols">
		t_user.id as user_id,
		t_user.name as user_name,
		t_user.sex as user_sex,
		t_user.date as user_date
	</sql>
	<resultMap type="user" id="userMap">
		<result property="id" column="user_id" />
		<result property="name" column="user_name" typeHandler="com.sundd.myspring.mybatis.MyTypeHandler"/>
		<result property="sexx" column="user_sex" />
		<result property="date" column="user_date" />
	</resultMap>
	<resultMap type="user" id="userAssoOrderMap" extends="userMap"> 
		<collection property="orderList" ofType="order" select="com.sundd.myspring.mapper.OrderMapper.get" column="id=user_id"></collection>
	</resultMap>
	
	<sql id="oracle_cols">
		t_user.id as user_id,
		t_user.name as user_name
	</sql>
		<resultMap type="user" id="oracle_userMap">
		<result property="id" column="user_id" />
		<result property="name" column="user_name" typeHandler="com.sundd.myspring.mybatis.MyTypeHandler"/>
	</resultMap>
	
	
	<insert id="add">
		<selectKey order="BEFORE" keyProperty="id" resultType="int">
			select seq_user_id.nextval from dual
		</selectKey>
		insert into t_user(id,name)
		values(#{id}, #{name,typeHandler=com.sundd.myspring.mybatis.MyTypeHandler})
	</insert>

	<delete id="delete">
		delete from t_user
		where id=#{id}
	</delete>

	<update id="update">
		update t_user
		set name=#{name}
		where id=#{id}
	</update>

	<select id="get" resultMap="userAssoOrderMap" flushCache="false">
		select
		<include refid="cols"></include>
		,
		<include refid="com.sundd.myspring.mapper.OrderMapper.cols"></include>
		from t_user left join t_order on t_user.id=t_order.user_id
		where t_user.id=#{bbb}
	</select>

	<select id="getBy" resultType="user">
		select
		<include refid="cols"></include>
		from t_user
		where name like concat("%",#{arg0},"%")
		and sex=#{arg1}
	</select>

	<insert id="addBatch">
		insert into t_user(name,sex,date)
		values
		<foreach collection="list" item="obj" separator="," >
			(#{obj.name},#{obj.sexx},now())
		</foreach>
	</insert>
	
	<select id="getList" resultMap="oracle_userMap">
		select
		<include refid="oracle_cols"></include>
		from t_user
	</select>
	
	<select id="selectOne" resultMap="userMap">
		select
		<include refid="cols"></include>
		from t_user
		where id=#{id}
	</select>

</mapper>
